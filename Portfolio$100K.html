<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Trade Performance Statistics - $100 K Portfolio</title>
<style>
:root{--bg:#0b0f14;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937;--blue:#60a5fa;--red:#ef4444}
body{margin:0;padding:28px;background:var(--bg);color:var(--text);font:14px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:1250px;margin:0 auto}
h1{margin:0 0 6px;font-size:22px}
.lead{margin:0 0 14px;color:var(--muted);max-width:1050px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin:12px 0}
.cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-top:8px}
@media(max-width:1050px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
.k{color:var(--muted);font-size:12px}
.v{font-size:22px;margin-top:6px}
.grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:12px}
@media(max-width:980px){.grid{grid-template-columns:1fr}body{padding:18px}}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 0}
select,input,button{background:#0f172a;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-size:13px}
button{cursor:pointer}
button.active{border-color:var(--blue);box-shadow:0 0 0 2px rgba(96,165,250,.25) inset}
canvas{width:100%;height:420px;display:block;background:#0b1220;border-radius:12px;border:1px solid var(--border)}
canvas.small{height:340px}
.table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.table th,.table td{padding:9px 10px;border-bottom:1px solid var(--border);white-space:nowrap}
.table th{text-align:left;font-weight:600;color:#d1d5db;background:#0f172a;position:sticky;top:0;z-index:1}
.tooltip{position:absolute;pointer-events:none;background:rgba(17,24,39,.95);border:1px solid var(--border);color:var(--text);padding:4px 6px;border-radius:10px;font-size:12px;display:none;white-space:nowrap;transform:translate(10px,-10px)}
.section-title{display:flex;align-items:center;justify-content:space-between;gap:12px}
.small{font-size:12px;color:var(--muted)}
.pos{color:var(--blue);font-weight:700}
.neg{color:var(--red);font-weight:700}
.defs{font-size:12px;line-height:1.45;color:var(--muted)}
.defs .term{color:var(--blue);font-weight:800}
.defs b{color:var(--blue);font-weight:800}
.defs .t1{color:var(--blue);font-weight:800}
.defs .t2{color:#a7f3d0;font-weight:800}
.defs .t3{color:#fbbf24;font-weight:800}
.defs .t4{color:#c4b5fd;font-weight:800}
</style></head><body><div class="wrap">
<div class="section-title">
  <div>
    <h1 id="pageTitle">Closed Trade Performance Statistics - $100 K Portfolio</h1>
    <p class="lead">Toggle between closed (realized) and open (current). The scatter updates with the toggle. The table shows closed trades only.</p>
  </div>
  <div class="controls" style="margin:0;">
    <span class="date-label" style="color:var(--muted);font-size:13px;margin-right:8px;">14 Feb, 2026</span>
    <button id="btnClosed" class="active">Closed</button>
    <button id="btnOpen">Open</button>
  </div>
</div>


<div class="cards" style="margin-top:10px">
  <div class="card">
    <div class="k">Total Equity Value ($)</div>
    <div class="v" style="color:#60a5fa">302,857</div>
    <div class="small" style="margin-top:4px">Starting $100,000 + Realized PnL $202,857</div>
  </div>
  <div class="card">
    <div class="k">Realized PnL ($)</div>
    <div class="v">202,857</div>
  </div>
  <div class="card">
    <div class="k">Total Closed PnL ($)</div>
    <div class="v">141,774</div>
  </div>
  <div class="card">
    <div class="k">Current Unrealized Open PnL ($)</div>
    <div class="v">146,430</div>
  </div>
</div>

<div class="cards">
  <div class="card" style="grid-column: span 4;">
    <div class="k">Equity Curve (closed trades only)</div>
    <div style="margin-top:6px;font-size:13px">
      <a href="https://www.tradesviz.com/viewstats/StratOptions/53ad83f03c1e9123" target="_blank" rel="noopener noreferrer" style="color:var(--blue);text-decoration:none;font-weight:700">
        View current Equity Curve
      </a>
      <div class="small" style="margin-top:6px">This link reflects the current equity curve for closed trades only.</div>
    </div>
  </div>
</div>

<div id="closedBlock"><div class="cards">
  <div class="card"><div class="k">Closed trades</div><div class="v">24</div></div>
  <div class="card"><div class="k">Win rate</div><div class="v">83.3%</div></div>
  <div class="card"><div class="k">Profit factor</div><div class="v">15.1</div></div>
  <div class="card"><div class="k">Avg PnL per trade ($)</div><div class="v">5,907.2</div></div>
  <div class="card"><div class="k">Avg PnL per day per trade ($)</div><div class="v">65.8</div></div>
  <div class="card"><div class="k">PnL per calendar day ($)</div><div class="v">675.1</div></div>
  <div class="card"><div class="k">Largest win ($)</div><div class="v pos">28,500</div></div>
  <div class="card"><div class="k">Largest loss ($)</div><div class="v neg">-6,300</div></div>
  <div class="card"><div class="k">Avg win ($)</div><div class="v pos">7,591.7</div></div>
  <div class="card"><div class="k">Avg loss ($)</div><div class="v neg">-2,515</div></div>
  <div class="card"><div class="k">Median time to peak (days)</div><div class="v">51</div></div>
  <div class="card"><div class="k">Median days after peak</div><div class="v">6.9</div></div>
  <div class="card"><div class="k">Median capture (PnL/MFE)</div><div class="v">0.9</div></div>
  <div class="card"><div class="k">Median duration (days)</div><div class="v">65.5</div></div>
  <div class="card"><div class="k">Median % return</div><div class="v">2,092.3%</div></div>
  <div class="card"><div class="k">Calendar days traded</div><div class="v">210</div></div>
</div></div>

<div id="openBlock" style="display:none;"><div class="cards">
  <div class="card"><div class="k">Open trades</div><div class="v">26</div></div>
  <div class="card"><div class="k">Win rate (current PnL)</div><div class="v">80.8%</div></div>
  <div class="card"><div class="k">Profit factor (current PnL)</div><div class="v">17.2</div></div>
  <div class="card"><div class="k">Median unrealized % return</div><div class="v">13.1%</div></div>
</div></div>

<div class="card"><div class="grid">
  <div style="position:relative">
    <div class="k" id="scatterTitle">Interactive scatter (closed trades)</div>
    <div class="controls">
      <label class="small">X-axis:</label>
      <select id="xSelect">
        <option value="dteOpen">DTE at Open</option>
        <option value="holdDays">Hold / Age (days)</option>
        <option value="vol">Total Volume</option>
        <option value="openPrice">Open Price</option>
        <option value="closePrice">Close Price</option>
        <option value="deltaPct">Delta %</option>
        <option value="openTs">Open Timestamp</option>
        <option value="closeTs">Close Timestamp</option>
      </select>
      <label class="small">Y-axis:</label>
      <select id="ySelect">
        <option value="pnl">PnL ($)</option>
        <option value="retPct">% Return</option>
        <option value="tradeMFE">Trade MFE ($)</option>
        <option value="tradeMAE">Trade MAE ($)</option>
        <option value="tradeRatio">Trade MFE/MAE</option>
        <option value="openPrice">Open Price</option>
        <option value="closePrice">Close Price</option>
        <option value="deltaPct">Delta %</option>
      </select>
      <label class="small">Filter symbol contains:</label>
      <input id="symFilter" placeholder="e.g., URA"/>
      <button id="resetBtn">Reset</button>
    </div>
    <canvas id="chart"></canvas>
    <div class="tooltip" id="tooltip"></div>
  </div>

  <div>
    <div class="k">Definitions</div>
    <div class="defs" style="margin-top:8px">
      <div><span class="term t1">Delta %</span> — percent change between Open Price and Close Price.</div>
      <div style="margin-top:6px"><span class="term t2">PnL</span> — profit or loss. Closed view uses realized PnL; Open view uses current PnL.</div>
      <div style="margin-top:6px"><span class="term t2">% Return</span> — trade return. Closed view uses realized return; Open view uses unrealized return.</div>
      <div style="margin-top:6px"><span class="term t3">Trade MFE</span> — highest unrealized profit the trade reached while it was open.</div>
      <div style="margin-top:6px"><span class="term t3">Trade MAE</span> — lowest unrealized profit (largest drawdown) the trade reached while it was open.</div>
      <div style="margin-top:6px"><span class="term t4">Trade MFE/MAE</span> — Trade MFE divided by the absolute value of Trade MAE.</div>

      <div style="margin-top:10px"><span class="term">Median % return</span> — middle value of % Return across trades.</div>
      <div style="margin-top:6px"><span class="term">Median duration</span> — middle value of duration (days held) across trades.</div>
      <div style="margin-top:6px"><span class="term">Median capture</span> — middle value of (PnL ÷ Trade MFE) on winning trades.</div>
      <div style="margin-top:6px"><span class="term">Median time to peak</span> — middle number of days from entry until a winning trade hit its max profit (MFE).</div>
      <div style="margin-top:6px"><span class="term">Median days after peak</span> — middle number of days a winning trade was held after it hit its max profit (MFE).</div>
    </div>
  </div>
</div></div>

<div class="card"><div class="grid">
  <div><div class="k">Win rate by structure (closed trades)</div><canvas id="barWin" class="small"></canvas></div>
  <div><div class="k">Typical time-to-peak (median MFE timing, closed trades)</div><canvas id="barPeak" class="small"></canvas></div>
</div></div>

<div class="card"><div class="k">Closed trades table</div><div id="closedTableWrap"><table border="1" class="dataframe table" id="closedTable">
  <thead>
    <tr style="text-align: right;">
      <th>Close Date</th>
      <th>Symbol</th>
      <th>Tags</th>
      <th>Strikes</th>
      <th>Open Price</th>
      <th>Close Price</th>
      <th>Delta %</th>
      <th>DTE (Open)</th>
      <th>Hold (days)</th>
      <th>Total Volume</th>
      <th>PnL</th>
      <th>% Return</th>
      <th>Trade MAE</th>
      <th>Trade MFE</th>
      <th>Trade MFE/MAE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2026-01-16</td>
      <td>SMH</td>
      <td>Vertical Bear Put</td>
      <td>325/345</td>
      <td>7.7</td>
      <td>4.5</td>
      <td>-41</td>
      <td>67</td>
      <td>67.1</td>
      <td>40</td>
      <td>-6,300</td>
      <td>-819</td>
      <td>-6,390</td>
      <td>7,950</td>
      <td>1.2</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>EU</td>
      <td>Vertical Bull Call</td>
      <td>2/4</td>
      <td>0.3</td>
      <td>0.6</td>
      <td>100</td>
      <td>144</td>
      <td>144</td>
      <td>600</td>
      <td>9,000</td>
      <td>30,000</td>
      <td>-1,950</td>
      <td>9,900</td>
      <td>5.1</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>DNN</td>
      <td>Synthetic</td>
      <td>2.5</td>
      <td>0.8</td>
      <td>0.2</td>
      <td>-72.2</td>
      <td>120</td>
      <td>120</td>
      <td>200</td>
      <td>5,450</td>
      <td>25,952</td>
      <td>-1,700</td>
      <td>5,450</td>
      <td>3.2</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>GLD</td>
      <td>Vertical Bull Call</td>
      <td>385/430</td>
      <td>19</td>
      <td>6</td>
      <td>-68.5</td>
      <td>56</td>
      <td>56</td>
      <td>20</td>
      <td>12,990</td>
      <td>2,170</td>
      <td>-740</td>
      <td>14,695</td>
      <td>19.9</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>CGAU</td>
      <td>Vertical Bull Call</td>
      <td>5/10</td>
      <td>4.2</td>
      <td>5.6</td>
      <td>33.6</td>
      <td>204</td>
      <td>204.1</td>
      <td>120</td>
      <td>8,520</td>
      <td>2,014</td>
      <td>-1,020</td>
      <td>10,020</td>
      <td>9.8</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>CCJ</td>
      <td>Vertical Bull Call</td>
      <td>80/100</td>
      <td>11.9</td>
      <td>19.3</td>
      <td>61.8</td>
      <td>129</td>
      <td>129</td>
      <td>40</td>
      <td>14,760</td>
      <td>1,237</td>
      <td>-130</td>
      <td>16,050</td>
      <td>123.5</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>SA</td>
      <td>Diagonal</td>
      <td>26/27</td>
      <td>3.2</td>
      <td>1.4</td>
      <td>-56</td>
      <td>98</td>
      <td>98.9</td>
      <td>160</td>
      <td>14,240</td>
      <td>10,171</td>
      <td>-2,080</td>
      <td>18,800</td>
      <td>9</td>
    </tr>
    <tr>
      <td>2026-01-16</td>
      <td>EEM</td>
      <td>Vertical Bull Call</td>
      <td>54/57</td>
      <td>2</td>
      <td>1</td>
      <td>-50.4</td>
      <td>56</td>
      <td>56</td>
      <td>100</td>
      <td>5,150</td>
      <td>5,074</td>
      <td>-1,275</td>
      <td>5,175</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>2025-12-20</td>
      <td>U.UN</td>
      <td>Vertical Bull Put</td>
      <td>25/27</td>
      <td>1.3</td>
      <td>1.3</td>
      <td>-1.9</td>
      <td>63</td>
      <td>64</td>
      <td>160</td>
      <td>200</td>
      <td>157</td>
      <td>—</td>
      <td>—</td>
      <td>—</td>
    </tr>
    <tr>
      <td>2025-12-19</td>
      <td>GLD</td>
      <td>Vertical Bull Put</td>
      <td>355/365</td>
      <td>1.6</td>
      <td>0.7</td>
      <td>-58.8</td>
      <td>25</td>
      <td>25</td>
      <td>40</td>
      <td>1,900</td>
      <td>2,857</td>
      <td>0</td>
      <td>1,900</td>
      <td>—</td>
    </tr>
    <tr>
      <td>2025-12-19</td>
      <td>AEM</td>
      <td>Vertical Bull Call</td>
      <td>140/160</td>
      <td>19.1</td>
      <td>12.3</td>
      <td>-35.5</td>
      <td>112</td>
      <td>112.9</td>
      <td>28</td>
      <td>9,520</td>
      <td>772</td>
      <td>-3,521</td>
      <td>12,194</td>
      <td>3.5</td>
    </tr>
    <tr>
      <td>2025-12-12</td>
      <td>IWM</td>
      <td>Iron Condor</td>
      <td>244/245/258/259</td>
      <td>0.4</td>
      <td>0.3</td>
      <td>-19.2</td>
      <td>7</td>
      <td>7.1</td>
      <td>240</td>
      <td>990</td>
      <td>2,849</td>
      <td>-300</td>
      <td>990</td>
      <td>3.3</td>
    </tr>
    <tr>
      <td>2025-11-24</td>
      <td>GC</td>
      <td>Vertical Bull Put</td>
      <td>3900/3950</td>
      <td>4.8</td>
      <td>2.2</td>
      <td>-52.6</td>
      <td>13</td>
      <td>13</td>
      <td>8</td>
      <td>1,000</td>
      <td>444</td>
      <td>—</td>
      <td>—</td>
      <td>—</td>
    </tr>
    <tr>
      <td>2025-11-21</td>
      <td>UEC</td>
      <td>Vertical Bull Call</td>
      <td>10/13</td>
      <td>0.6</td>
      <td>0.7</td>
      <td>12.5</td>
      <td>93</td>
      <td>93.9</td>
      <td>80</td>
      <td>300</td>
      <td>500</td>
      <td>0</td>
      <td>4,400</td>
      <td>—</td>
    </tr>
    <tr>
      <td>2025-11-21</td>
      <td>NXE</td>
      <td>Vertical Bull Call</td>
      <td>7/9</td>
      <td>0.5</td>
      <td>0.6</td>
      <td>3.7</td>
      <td>154</td>
      <td>154.9</td>
      <td>400</td>
      <td>-400</td>
      <td>-714</td>
      <td>-1,800</td>
      <td>14,700</td>
      <td>8.2</td>
    </tr>
    <tr>
      <td>2025-11-14</td>
      <td>PYPL</td>
      <td>Iron Condor</td>
      <td>62/64/74/76</td>
      <td>0.3</td>
      <td>0.4</td>
      <td>45.5</td>
      <td>14</td>
      <td>14</td>
      <td>160</td>
      <td>-920</td>
      <td>-2,503</td>
      <td>-1,500</td>
      <td>820</td>
      <td>0.5</td>
    </tr>
    <tr>
      <td>2025-11-07</td>
      <td>CCJ</td>
      <td>Vertical Bull Put</td>
      <td>75/84</td>
      <td>2.4</td>
      <td>0.9</td>
      <td>-63.9</td>
      <td>43</td>
      <td>43.1</td>
      <td>80</td>
      <td>6,200</td>
      <td>7,086</td>
      <td>-3,460</td>
      <td>6,320</td>
      <td>1.8</td>
    </tr>
    <tr>
      <td>2025-11-07</td>
      <td>AMD</td>
      <td>Vertical Bull Call</td>
      <td>260/262.5</td>
      <td>6.2</td>
      <td>5.6</td>
      <td>-9.9</td>
      <td>7</td>
      <td>7.1</td>
      <td>80</td>
      <td>-2,440</td>
      <td>-396</td>
      <td>-2,440</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2025-11-03</td>
      <td>MRVL</td>
      <td>Diagonal</td>
      <td>75/84</td>
      <td>16.7</td>
      <td>9.8</td>
      <td>-41.5</td>
      <td>545</td>
      <td>100.8</td>
      <td>20</td>
      <td>6,910</td>
      <td>709</td>
      <td>—</td>
      <td>—</td>
      <td>—</td>
    </tr>
    <tr>
      <td>2025-10-31</td>
      <td>RTX</td>
      <td>Vertical Bull Put</td>
      <td>152.5/155</td>
      <td>1.6</td>
      <td>1.1</td>
      <td>-29.7</td>
      <td>37</td>
      <td>37.9</td>
      <td>200</td>
      <td>4,700</td>
      <td>4,234</td>
      <td>-3,550</td>
      <td>6,400</td>
      <td>1.8</td>
    </tr>
    <tr>
      <td>2025-10-31</td>
      <td>DE</td>
      <td>Iron Condor</td>
      <td>440/442.5/490/492.5</td>
      <td>1</td>
      <td>0.8</td>
      <td>-16.6</td>
      <td>8</td>
      <td>8</td>
      <td>72</td>
      <td>594</td>
      <td>716</td>
      <td>-450</td>
      <td>1,827</td>
      <td>4.1</td>
    </tr>
    <tr>
      <td>2025-10-15</td>
      <td>UUUU</td>
      <td>Vertical Bull Call</td>
      <td>8/12</td>
      <td>8.2</td>
      <td>9.6</td>
      <td>17.4</td>
      <td>204</td>
      <td>111.8</td>
      <td>400</td>
      <td>28,500</td>
      <td>3,471</td>
      <td>-7,500</td>
      <td>28,500</td>
      <td>3.8</td>
    </tr>
    <tr>
      <td>2025-10-15</td>
      <td>SA</td>
      <td>Vertical Bull Call</td>
      <td>17/20</td>
      <td>5.4</td>
      <td>4.5</td>
      <td>-17.4</td>
      <td>141</td>
      <td>104.8</td>
      <td>400</td>
      <td>18,900</td>
      <td>4,223</td>
      <td>-2,000</td>
      <td>37,500</td>
      <td>18.8</td>
    </tr>
    <tr>
      <td>2025-10-15</td>
      <td>SLV</td>
      <td>Vertical Bull Put</td>
      <td>38.5/41</td>
      <td>0.8</td>
      <td>0.5</td>
      <td>-41.9</td>
      <td>53</td>
      <td>15.9</td>
      <td>120</td>
      <td>2,010</td>
      <td>4,323</td>
      <td>0</td>
      <td>2,010</td>
      <td>—</td>
    </tr>
  </tbody><tfoot><tr><td colspan='10' style='text-align:right;font-weight:700;color:#9ca3af;background:#0f172a;border-top:1px solid var(--border)'>Total Closed PnL</td><td style='font-weight:800;background:#0f172a;border-top:1px solid var(--border)' class='pos'>141,774</td><td colspan='4' style='background:#0f172a;border-top:1px solid var(--border)'></td></tr></tfoot>
</table></div></div>
<div class="small">Generated by Strategic Options trader</div></div>

<script>
const CLOSED_ROWS=[{"symbol": "SMH", "tags": "Vertical Bear Put", "dteOpen": 67.0, "holdDays": 67.05849537037037, "vol": 40.0, "pnl": -6300.0, "retPct": -819.2458, "tradeMFE": 7950.0, "tradeMAE": -6390.0, "tradeRatio": 1.244131455399061, "openPrice": 7.69, "closePrice": 4.54, "deltaPct": -40.96228868660599, "openTs": 1762808746.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "EU", "tags": "Vertical Bull Call", "dteOpen": 144.0, "holdDays": 144.02229166666666, "vol": 600.0, "pnl": 9000.0, "retPct": 30000.0, "tradeMFE": 9900.0, "tradeMAE": -1950.0, "tradeRatio": 5.076923076923077, "openPrice": 0.3, "closePrice": 0.6, "deltaPct": 100.0, "openTs": 1756159074.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "DNN", "tags": "Synthetic", "dteOpen": 120.0, "holdDays": 120.04980324074074, "vol": 200.0, "pnl": 5450.0, "retPct": 25952.381, "tradeMFE": 5450.0, "tradeMAE": -1700.0, "tradeRatio": 3.2058823529411766, "openPrice": 0.755, "closePrice": 0.21, "deltaPct": -72.18543046357617, "openTs": 1758230297.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "GLD", "tags": "Vertical Bull Call", "dteOpen": 56.0, "holdDays": 55.95811342592592, "vol": 20.0, "pnl": 12990.0, "retPct": 2170.4261, "tradeMFE": 14695.0, "tradeMAE": -740.0, "tradeRatio": 19.85810810810811, "openPrice": 18.975, "closePrice": 5.985, "deltaPct": -68.45849802371542, "openTs": 1763767819.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "CGAU", "tags": "Vertical Bull Call", "dteOpen": 204.0, "holdDays": 204.11032407407407, "vol": 120.0, "pnl": 8520.0, "retPct": 2014.1844, "tradeMFE": 10020.0, "tradeMAE": -1020.0, "tradeRatio": 9.823529411764707, "openPrice": 4.23, "closePrice": 5.65, "deltaPct": 33.56973995271867, "openTs": 1750967468.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "CCJ", "tags": "Vertical Bull Call", "dteOpen": 129.0, "holdDays": 128.9957638888889, "vol": 40.0, "pnl": 14760.0, "retPct": 1236.6988, "tradeMFE": 16050.0, "tradeMAE": -130.0, "tradeRatio": 123.46153846153847, "openPrice": 11.935, "closePrice": 19.315, "deltaPct": 61.8349392542941, "openTs": 1757457366.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "SA", "tags": "Diagonal", "dteOpen": 98.0, "holdDays": 98.93515046296297, "vol": 160.0, "pnl": 14240.0, "retPct": 10171.4286, "tradeMFE": 18800.0, "tradeMAE": -2080.0, "tradeRatio": 9.038461538461538, "openPrice": 3.18, "closePrice": 1.4, "deltaPct": -55.974842767295605, "openTs": 1760054603.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "EEM", "tags": "Vertical Bull Call", "dteOpen": 56.0, "holdDays": 55.95811342592592, "vol": 100.0, "pnl": 5150.0, "retPct": 5073.8916, "tradeMFE": 5175.0, "tradeMAE": -1275.0, "tradeRatio": 4.0588235294117645, "openPrice": 2.045, "closePrice": 1.015, "deltaPct": -50.36674816625917, "openTs": 1763767819.0, "closeTs": 1768602600.0, "assetType": "stock_option"}, {"symbol": "U.UN", "tags": "Vertical Bull Put", "dteOpen": 63.0, "holdDays": 63.97554398148148, "vol": 160.0, "pnl": 200.0, "retPct": 156.8627, "tradeMFE": null, "tradeMAE": null, "tradeRatio": null, "openPrice": 1.3, "closePrice": 1.275, "deltaPct": -1.9230769230769333, "openTs": 1760664646.0, "closeTs": 1766192133.0, "assetType": "stock_option"}, {"symbol": "GLD", "tags": "Vertical Bull Put", "dteOpen": 25.0, "holdDays": 24.978402777777777, "vol": 40.0, "pnl": 1900.0, "retPct": 2857.1429, "tradeMFE": 1900.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 1.615, "closePrice": 0.665, "deltaPct": -58.82352941176471, "openTs": 1764025266.0, "closeTs": 1766183400.0, "assetType": "stock_option"}, {"symbol": "AEM", "tags": "Vertical Bull Call", "dteOpen": 112.0, "holdDays": 112.8975, "vol": 28.0, "pnl": 9520.0, "retPct": 772.1006, "tradeMFE": 12194.0, "tradeMAE": -3521.0, "tradeRatio": 3.463220675944334, "openPrice": 19.13, "closePrice": 12.33, "deltaPct": -35.54626241505488, "openTs": 1756429056.0, "closeTs": 1766183400.0, "assetType": "stock_option"}, {"symbol": "IWM", "tags": "Iron Condor", "dteOpen": 7.0, "holdDays": 7.0704976851851855, "vol": 240.0, "pnl": 990.0, "retPct": 2848.9209, "tradeMFE": 990.0, "tradeMAE": -300.0, "tradeRatio": 3.3, "openPrice": 0.43, "closePrice": 0.3475, "deltaPct": -19.18604651162791, "openTs": 1764967709.0, "closeTs": 1765578600.0, "assetType": "stock_option"}, {"symbol": "GC", "tags": "Vertical Bull Put", "dteOpen": 13.0, "holdDays": 13.034212962962963, "vol": 8.0, "pnl": 1000.0, "retPct": 444.4444, "tradeMFE": null, "tradeMAE": null, "tradeRatio": null, "openPrice": 4.75, "closePrice": 2.25, "deltaPct": -52.63157894736842, "openTs": 1762897244.0, "closeTs": 1764023400.0, "assetType": "stock_option"}, {"symbol": "UEC", "tags": "Vertical Bull Call", "dteOpen": 93.0, "holdDays": 93.89498842592593, "vol": 80.0, "pnl": 300.0, "retPct": 500.0, "tradeMFE": 4400.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 0.6, "closePrice": 0.675, "deltaPct": 12.50000000000001, "openTs": 1755651673.0, "closeTs": 1763764200.0, "assetType": "stock_option"}, {"symbol": "NXE", "tags": "Vertical Bull Call", "dteOpen": 154.0, "holdDays": 154.8780787037037, "vol": 400.0, "pnl": -400.0, "retPct": -714.2857, "tradeMFE": 14700.0, "tradeMAE": -1800.0, "tradeRatio": 8.166666666666666, "openPrice": 0.54, "closePrice": 0.56, "deltaPct": 3.703703703703707, "openTs": 1750382734.0, "closeTs": 1763764200.0, "assetType": "stock_option"}, {"symbol": "PYPL", "tags": "Iron Condor", "dteOpen": 14.0, "holdDays": 13.970335648148149, "vol": 160.0, "pnl": -920.0, "retPct": -2503.4014, "tradeMFE": 820.0, "tradeMAE": -1500.0, "tradeRatio": 0.5466666666666666, "openPrice": 0.2525, "closePrice": 0.3675, "deltaPct": 45.54455445544554, "openTs": 1761952363.0, "closeTs": 1763159400.0, "assetType": "stock_option"}, {"symbol": "CCJ", "tags": "Vertical Bull Put", "dteOpen": 43.0, "holdDays": 43.0903125, "vol": 80.0, "pnl": 6200.0, "retPct": 7085.7143, "tradeMFE": 6320.0, "tradeMAE": -3460.0, "tradeRatio": 1.8265895953757225, "openPrice": 2.425, "closePrice": 0.875, "deltaPct": -63.91752577319587, "openTs": 1758831597.0, "closeTs": 1762554600.0, "assetType": "stock_option"}, {"symbol": "AMD", "tags": "Vertical Bull Call", "dteOpen": 7.0, "holdDays": 7.053668981481482, "vol": 80.0, "pnl": -2440.0, "retPct": -396.1039, "tradeMFE": 0.0, "tradeMAE": -2440.0, "tradeRatio": 0.0, "openPrice": 6.16, "closePrice": 5.55, "deltaPct": -9.902597402597408, "openTs": 1761945163.0, "closeTs": 1762554600.0, "assetType": "stock_option"}, {"symbol": "MRVL", "tags": "Diagonal", "dteOpen": 545.0, "holdDays": 100.81041666666667, "vol": 20.0, "pnl": 6910.0, "retPct": 708.7179, "tradeMFE": null, "tradeMAE": null, "tradeRatio": null, "openPrice": 16.66, "closePrice": 9.75, "deltaPct": -41.4765906362545, "openTs": 1753492185.0, "closeTs": 1762202205.0, "assetType": "stock_option"}, {"symbol": "RTX", "tags": "Vertical Bull Put", "dteOpen": 37.0, "holdDays": 37.89340277777778, "vol": 200.0, "pnl": 4700.0, "retPct": 4234.2342, "tradeMFE": 6400.0, "tradeMAE": -3550.0, "tradeRatio": 1.8028169014084507, "openPrice": 1.58, "closePrice": 1.11, "deltaPct": -29.746835443037973, "openTs": 1758672210.0, "closeTs": 1761946200.0, "assetType": "stock_option"}, {"symbol": "DE", "tags": "Iron Condor", "dteOpen": 8.0, "holdDays": 8.012453703703704, "vol": 72.0, "pnl": 594.0, "retPct": 715.6627, "tradeMFE": 1827.0, "tradeMAE": -450.0, "tradeRatio": 4.06, "openPrice": 0.995, "closePrice": 0.83, "deltaPct": -16.582914572864325, "openTs": 1761253924.0, "closeTs": 1761946200.0, "assetType": "stock_option"}, {"symbol": "UUUU", "tags": "Vertical Bull Call", "dteOpen": 204.0, "holdDays": 111.80724537037037, "vol": 400.0, "pnl": 28500.0, "retPct": 3471.3764, "tradeMFE": 28500.0, "tradeMAE": -7500.0, "tradeRatio": 3.8, "openPrice": 8.21, "closePrice": 9.635, "deltaPct": 17.356881851400715, "openTs": 1750901134.0, "closeTs": 1760561280.0, "assetType": "stock_option"}, {"symbol": "SA", "tags": "Vertical Bull Call", "dteOpen": 141.0, "holdDays": 104.80155092592592, "vol": 400.0, "pnl": 18900.0, "retPct": 4223.4637, "tradeMFE": 37500.0, "tradeMAE": -2000.0, "tradeRatio": 18.75, "openPrice": 5.42, "closePrice": 4.475, "deltaPct": -17.435424354243548, "openTs": 1751505934.0, "closeTs": 1760560788.0, "assetType": "stock_option"}, {"symbol": "SLV", "tags": "Vertical Bull Put", "dteOpen": 53.0, "holdDays": 15.94787037037037, "vol": 120.0, "pnl": 2010.0, "retPct": 4322.5806, "tradeMFE": 2010.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 0.8, "closePrice": 0.465, "deltaPct": -41.875, "openTs": 1759182513.0, "closeTs": 1760560409.0, "assetType": "stock_option"}];
const OPEN_ROWS=[{"symbol": "SOFR3", "tags": "Vertical Bull Call", "dteOpen": 385.0, "holdDays": 84.87554609883102, "vol": 20.0, "pnl": 0.0, "retPct": 0.0, "tradeMFE": null, "tradeMAE": null, "tradeRatio": null, "openPrice": 0.077, "closePrice": null, "deltaPct": 0.0, "openTs": 1763767245.0, "closeTs": 1763767245.0, "assetType": "stock_option"}, {"symbol": "SLVP", "tags": "Vertical Bull Call", "dteOpen": 211.0, "holdDays": 23.76018730253472, "vol": 100.0, "pnl": -3200.0, "retPct": -9.696969696969695, "tradeMFE": 19750.0, "tradeMAE": -156450.0, "tradeRatio": 0.12623841482901885, "openPrice": 10.55, "closePrice": null, "deltaPct": -9.696969696969695, "openTs": 1769047612.0, "closeTs": 1769047612.0, "assetType": "stock_option"}, {"symbol": "CCJ", "tags": "Vertical Bull Put", "dteOpen": 116.0, "holdDays": 81.88294193216436, "vol": 20.0, "pnl": 4540.0, "retPct": 75.16556291390728, "tradeMFE": 110400.0, "tradeMAE": -5800.0, "tradeRatio": 19.03448275862069, "openPrice": 10.99, "closePrice": null, "deltaPct": 75.16556291390728, "openTs": 1764025806.0, "closeTs": 1764025806.0, "assetType": "stock_option"}, {"symbol": "SA", "tags": "Vertical Bull Call", "dteOpen": 133.0, "holdDays": 127.84593961734954, "vol": 200.0, "pnl": 38500.0, "retPct": 108.45070422535213, "tradeMFE": 292800.0, "tradeMAE": -9500.0, "tradeRatio": 30.821052631578947, "openPrice": 1.15, "closePrice": null, "deltaPct": 108.45070422535213, "openTs": 1760054603.0, "closeTs": 1760054603.0, "assetType": "stock_option"}, {"symbol": "ORLA", "tags": "Vertical Bull Call", "dteOpen": 188.0, "holdDays": 35.736680358090275, "vol": 70.0, "pnl": 1680.0, "retPct": 17.77777777777778, "tradeMFE": 46795.0, "tradeMAE": -280.0, "tradeRatio": 167.125, "openPrice": 1.3, "closePrice": null, "deltaPct": 17.77777777777778, "openTs": 1768012843.0, "closeTs": 1768012843.0, "assetType": "stock_option"}, {"symbol": "PAAS", "tags": "", "dteOpen": 11.791784524756943, "holdDays": 11.791784524756943, "vol": 95.0, "pnl": 468.35, "retPct": 9.30188679245283, "tradeMFE": 808.0, "tradeMAE": -368.0, "tradeRatio": 2.1956521739130435, "openPrice": 53.0, "closePrice": null, "deltaPct": 9.30188679245283, "openTs": 1770081682.0, "closeTs": 1770081682.0, "assetType": "stock"}, {"symbol": "ASPI", "tags": "Vertical Bull Call", "dteOpen": 176.0, "holdDays": 22.854967395127314, "vol": 200.0, "pnl": -5400.0, "retPct": -36.98630136986301, "tradeMFE": 10600.0, "tradeMAE": -36700.0, "tradeRatio": 0.2888283378746594, "openPrice": 2.46, "closePrice": null, "deltaPct": -36.98630136986301, "openTs": 1769125823.0, "closeTs": 1769125823.0, "assetType": "stock_option"}, {"symbol": "SSRM", "tags": "", "dteOpen": 10.798092395127314, "holdDays": 10.798092395127314, "vol": 210.0, "pnl": 955.5, "retPct": 19.31239388794567, "tradeMFE": 856.0, "tradeMAE": -338.0, "tradeRatio": 2.532544378698225, "openPrice": 23.56, "closePrice": null, "deltaPct": 19.31239388794567, "openTs": 1770167537.0, "closeTs": 1770167537.0, "assetType": "stock"}, {"symbol": "CRML", "tags": "Vertical Bull Call", "dteOpen": 140.0, "holdDays": 133.8834164692014, "vol": 80.0, "pnl": 5160.0, "retPct": 66.83937823834196, "tradeMFE": 6280.0, "tradeMAE": -75480.0, "tradeRatio": 0.08320084790673025, "openPrice": 2.66, "closePrice": null, "deltaPct": 66.83937823834196, "openTs": 1759532965.0, "closeTs": 1759532965.0, "assetType": "stock_option"}, {"symbol": "MUX", "tags": "Vertical Bull Call", "dteOpen": 164.0, "holdDays": 73.9311826729051, "vol": 20.0, "pnl": -190.0, "retPct": -10.0, "tradeMFE": 21450.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 1.9, "closePrice": null, "deltaPct": -10.0, "openTs": 1764712838.0, "closeTs": 1764712838.0, "assetType": "stock_option"}, {"symbol": "GDX", "tags": "Synthetic", "dteOpen": 157.0, "holdDays": 151.846634061794, "vol": 20.0, "pnl": 30700.0, "retPct": 449.48755490483165, "tradeMFE": 5350.0, "tradeMAE": -92880.0, "tradeRatio": 0.05760120585701981, "openPrice": 6.83, "closePrice": null, "deltaPct": 449.48755490483165, "openTs": 1757980943.0, "closeTs": 1757980943.0, "assetType": "stock_option"}, {"symbol": "B", "tags": "Vertical Bull Call", "dteOpen": 143.0, "holdDays": 109.02548822846066, "vol": 60.0, "pnl": 20310.0, "retPct": 269.7211155378486, "tradeMFE": 128640.0, "tradeMAE": -630.0, "tradeRatio": 204.1904761904762, "openPrice": 0.71, "closePrice": null, "deltaPct": 269.7211155378486, "openTs": 1761680690.0, "closeTs": 1761680690.0, "assetType": "stock_option"}, {"symbol": "JAG", "tags": "", "dteOpen": 9.909203506238425, "holdDays": 9.909203506238425, "vol": 850.0, "pnl": 142.16001763, "retPct": 2.8880237296658757, "tradeMFE": 380.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 5.79105628, "closePrice": null, "deltaPct": 2.8880237296658757, "openTs": 1770244337.0, "closeTs": 1770244337.0, "assetType": "stock"}, {"symbol": "NEM", "tags": "Synthetic", "dteOpen": 177.0, "holdDays": 52.9368076729051, "vol": 20.0, "pnl": 17170.0, "retPct": 135.30338849487785, "tradeMFE": 105420.0, "tradeMAE": -1990.0, "tradeRatio": 52.97487437185929, "openPrice": 9.51, "closePrice": null, "deltaPct": 135.30338849487785, "openTs": 1766526752.0, "closeTs": 1766526752.0, "assetType": "stock_option"}, {"symbol": "SLV", "tags": "Vertical Bull Call", "dteOpen": 70.0, "holdDays": 7.856263691423611, "vol": 20.0, "pnl": -230.0, "retPct": -2.421052631578948, "tradeMFE": 58160.0, "tradeMAE": -2800.0, "tradeRatio": 20.771428571428572, "openPrice": 5.35, "closePrice": null, "deltaPct": -2.421052631578948, "openTs": 1770421711.0, "closeTs": 1770421711.0, "assetType": "stock_option"}, {"symbol": "BTO", "tags": "", "dteOpen": 9.90364795068287, "holdDays": 9.90364795068287, "vol": 1030.0, "pnl": 499.44897509, "retPct": 9.903211098151417, "tradeMFE": 906.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 4.896411, "closePrice": null, "deltaPct": 9.903211098151417, "openTs": 1770244817.0, "closeTs": 1770244817.0, "assetType": "stock"}, {"symbol": "EDV", "tags": "", "dteOpen": 10.77725906179398, "holdDays": 10.77725906179398, "vol": 90.0, "pnl": 512.45316288, "retPct": 10.077263648379155, "tradeMFE": 678.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 56.50268, "closePrice": null, "deltaPct": 10.077263648379155, "openTs": 1770169337.0, "closeTs": 1770169337.0, "assetType": "stock"}, {"symbol": "AG", "tags": "", "dteOpen": 5.793867858090278, "holdDays": 5.793867858090278, "vol": 245.0, "pnl": 676.2, "retPct": 13.663366336633665, "tradeMFE": 1168.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 20.2, "closePrice": null, "deltaPct": 13.663366336633665, "openTs": 1770599902.0, "closeTs": 1770599902.0, "assetType": "stock"}, {"symbol": "NEM", "tags": "Vertical Bull Call", "dteOpen": 151.0, "holdDays": 116.98512943216436, "vol": 20.0, "pnl": 14700.0, "retPct": 337.9310344827586, "tradeMFE": 3600.0, "tradeMAE": -113760.0, "tradeRatio": 0.03164556962025317, "openPrice": 14.0, "closePrice": null, "deltaPct": 337.9310344827586, "openTs": 1760992977.0, "closeTs": 1760992977.0, "assetType": "stock_option"}, {"symbol": "PRU", "tags": "", "dteOpen": 10.760592395127315, "holdDays": 10.760592395127315, "vol": 1300.0, "pnl": 286.53295129, "retPct": 5.682031067517968, "tradeMFE": 482.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 3.87907, "closePrice": null, "deltaPct": 5.682031067517968, "openTs": 1770170777.0, "closeTs": 1770170777.0, "assetType": "stock"}, {"symbol": "SVM", "tags": "", "dteOpen": 5.8028956358680555, "holdDays": 5.8028956358680555, "vol": 510.0, "pnl": 586.5, "retPct": 11.698880976602236, "tradeMFE": 892.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 9.83, "closePrice": null, "deltaPct": 11.698880976602236, "openTs": 1770599122.0, "closeTs": 1770599122.0, "assetType": "stock"}, {"symbol": "CDE", "tags": "", "dteOpen": 5.786923413645834, "holdDays": 5.786923413645834, "vol": 250.0, "pnl": 620.0, "retPct": 12.437311935807422, "tradeMFE": 980.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 19.94, "closePrice": null, "deltaPct": 12.437311935807422, "openTs": 1770600502.0, "closeTs": 1770600502.0, "assetType": "stock"}, {"symbol": "EXK", "tags": "Vertical Bull Call", "dteOpen": 121.0, "holdDays": 114.9626062840162, "vol": 80.0, "pnl": 11000.0, "retPct": 158.04597701149427, "tradeMFE": 1680.0, "tradeMAE": -41800.0, "tradeRatio": 0.04019138755980861, "openPrice": 1.74, "closePrice": null, "deltaPct": 158.04597701149427, "openTs": 1761167723.0, "closeTs": 1761167723.0, "assetType": "stock_option"}, {"symbol": "HCHDF", "tags": "", "dteOpen": 7.989469709942129, "holdDays": 7.989469709942129, "vol": 850.0, "pnl": 637.5, "retPct": 8.771929824561402, "tradeMFE": 1062.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 8.55, "closePrice": null, "deltaPct": 8.771929824561402, "openTs": 1770410202.0, "closeTs": 1770410202.0, "assetType": "stock"}, {"symbol": "URA", "tags": "Vertical Bull Call", "dteOpen": 150.0, "holdDays": 88.78370582105325, "vol": 10.0, "pnl": 3425.0, "retPct": 80.58823529411765, "tradeMFE": 21875.0, "tradeMAE": -1070.0, "tradeRatio": 20.44392523364486, "openPrice": 2.5, "closePrice": null, "deltaPct": 80.58823529411765, "openTs": 1763429580.0, "closeTs": 1763429580.0, "assetType": "stock_option"}, {"symbol": "SLVR", "tags": "Vertical Bull Call", "dteOpen": 108.0, "holdDays": 45.86787248771991, "vol": 40.0, "pnl": 2880.0, "retPct": 24.0, "tradeMFE": 2700.0, "tradeMAE": -462720.0, "tradeRatio": 0.0058350622406639005, "openPrice": 10.15, "closePrice": null, "deltaPct": 24.0, "openTs": 1767137508.0, "closeTs": 1767137508.0, "assetType": "stock_option"}];
const tagLabels=["Diagonal", "Iron Condor", "Synthetic", "Vertical Bull Call", "Vertical Bull Put"];
const tagWinRates=[100.0, 66.7, 100.0, 81.8, 100.0];
const tagTimeToPeak=[73.0, 5.3, 119.1, 53.0, 22.0];
let activeMode='closed';


// Number formatter (commas, no decimals)
// Display integers for numerical values (e.g., PnL). Percent values will append '%' manually when needed.
const NF = new Intl.NumberFormat('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
function fmtNum(v, isPct=false){
  if(v===null || v===undefined || !isFinite(v)) return '—';
  return isPct ? (NF.format(v) + '%') : NF.format(v);
}
function activeRows(){ return (activeMode==='open') ? OPEN_ROWS : CLOSED_ROWS; }
function getVal(r,k){ const v=r[k]; return (v===null||v===undefined||Number.isNaN(v)) ? null : Number(v); }
function filterRows(rows){ const f=document.getElementById('symFilter').value.trim().toUpperCase(); if(!f) return rows; return rows.filter(r => (r.symbol||'').toUpperCase().includes(f)); }

function niceNumber(x, roundIt){
  if(!isFinite(x) || x<=0) return 1;
  const exp = Math.floor(Math.log10(x));
  const f = x / Math.pow(10, exp);
  let nf;
  if(roundIt){
    if(f < 1.5) nf = 1;
    else if(f < 3) nf = 2;
    else if(f < 7) nf = 5;
    else nf = 10;
  } else {
    if(f <= 1) nf = 1;
    else if(f <= 2) nf = 2;
    else if(f <= 5) nf = 5;
    else nf = 10;
  }
  return nf * Math.pow(10, exp);
}
function niceBounds(minV, maxV, ticksWanted){
  const range = niceNumber(maxV - minV, false);
  const step = niceNumber(range / Math.max(1, ticksWanted-1), true);
  const niceMin = Math.floor(minV / step) * step;
  const niceMax = Math.ceil(maxV / step) * step;
  return {niceMin, niceMax, step};
}

let lastPlot=null;
// Global viewBox that stores the current visible data extents for zooming. When null,
// the scatter will compute its own extents from the data and initialize this. It is
// updated by mouse wheel events on the chart to implement zooming.
let viewBox=null;
function drawScatter(data,xKey,yKey) {
  const c=document.getElementById('chart'); const ctx=c.getContext('2d'); const tt=document.getElementById('tooltip');
  const w=c.clientWidth,h=c.clientHeight,dpr=window.devicePixelRatio||1;
  c.width=Math.floor(w*dpr); c.height=Math.floor(h*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,w,h);

  const isPct=(yKey==='retPct'||yKey==='deltaPct');
  const isDate=(xKey==='openTs' || xKey==='closeTs');
  const pts=[];
  for(const r of data) {
    let x = getVal(r, xKey);
    const y = getVal(r, yKey);
    if(y === null) continue;
    // Always use open timestamp for stocks (non-option trades) so they appear on timeline. Also if x is null use openTs.
    if((!r.assetType || r.assetType !== 'stock_option') && xKey !== 'openTs') {
      const fallback = getVal(r, 'openTs');
      x = (x === null) ? fallback : x;
    }
    if(x === null) continue;
    // Include assetType for coloring stocks green
    pts.push({x, y, symbol: r.symbol, assetType: r.assetType});
  }
  tt.style.display='none';
  if(!pts.length) { ctx.fillStyle='#9ca3af'; ctx.fillText('No data matches the current filter.',16,24); lastPlot=null; return; }

  const padL=52,padR=18,padT=18,padB=42; const pw=w-padL-padR, ph=h-padT-padB;

  // Determine raw data extents across all points
  let xMinData=Math.min(...pts.map(p=>p.x)), xMaxData=Math.max(...pts.map(p=>p.x));
  let yMinData=Math.min(...pts.map(p=>p.y)), yMaxData=Math.max(...pts.map(p=>p.y));
  let xMin, xMax, yMin, yMax;
  if(viewBox) {
    // Use existing viewBox extents if a zoom has been set
    xMin = viewBox.xMin;
    xMax = viewBox.xMax;
    yMin = viewBox.yMin;
    yMax = viewBox.yMax;
  } else {
    // Expand data extents slightly to pad the plot and initialize viewBox
    const xPad=(xMaxData-xMinData)*0.05||1;
    const yPad=(yMaxData-yMinData)*0.08||1;
    xMin = xMinData - xPad;
    xMax = xMaxData + xPad;
    yMin = yMinData - yPad;
    yMax = yMaxData + yPad;
    viewBox = { xMin: xMin, xMax: xMax, yMin: yMin, yMax: yMax };
  }

  const xS=x=>padL+(x-xMin)/(xMax-xMin)*pw;
  const yS=y=>padT+(1-(y-yMin)/(yMax-yMin))*ph;

  ctx.strokeStyle='#1f2937'; ctx.lineWidth=1;
  ctx.beginPath(); ctx.moveTo(padL,padT); ctx.lineTo(padL,padT+ph); ctx.lineTo(padL+pw,padT+ph); ctx.stroke();

  ctx.fillStyle='#9ca3af';
  ctx.font='12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';

    for(let i=0;i<=5;i++) {
        const t=xMin+(xMax-xMin)*(i/5);
        const x=xS(t);
        ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(x,padT); ctx.lineTo(x,padT+ph); ctx.stroke();
        let label;
        if(isDate) {
          // Format date as Mon'YY (e.g., Jan'25)
          const d=new Date(t*1000);
          const mons=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
          const month=mons[d.getMonth()];
          const yr=String(d.getFullYear()).slice(-2);
          label=`${month}'${yr}`;
        } else {
          label=NF.format(t);
        }
        const tw=ctx.measureText(label).width;
        ctx.fillText(label, x - tw/2, padT+ph+18);
      }

  const tb = niceBounds(yMin, yMax, 5);
  const y0 = tb.niceMin, y1 = tb.niceMax, step = tb.step;

  for(let t=y0; t<=y1+1e-9; t+=step) {
    const y=yS(t);
    ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+pw,y); ctx.stroke();
    const lab = fmtNum(t, isPct);
    ctx.fillText(lab, 8, y+4);
  }

  ctx.fillStyle='#e5e7eb';
  const xLab=document.getElementById('xSelect').selectedOptions[0].textContent;
  const yLab=document.getElementById('ySelect').selectedOptions[0].textContent;
  ctx.fillText(xLab, padL+pw/2-40, padT+ph+36);
  ctx.save(); ctx.translate(14, padT+ph/2+30); ctx.rotate(-Math.PI/2); ctx.fillText(yLab,0,0); ctx.restore();

  const plotPts=[];
  for(const p of pts) {
    const sx=xS(p.x), sy=yS(p.y);
    // Stocks (non-option trades) are colored green; options use blue/red based on sign
    let col;
    if(p.assetType && p.assetType !== 'stock_option') {
      // green color for stocks
      col = 'rgba(34,197,94,0.9)';
    } else {
      col = (p.y < 0) ? 'rgba(239,68,68,0.9)' : 'rgba(96,165,250,0.9)';
    }
    ctx.fillStyle = col;
    // Draw with slightly larger radius for stock points to help distinguish overlapping stocks
    const radius = (p.assetType && p.assetType !== 'stock_option') ? 4.0 : 3.2;
    ctx.beginPath(); ctx.arc(sx, sy, radius, 0, Math.PI*2); ctx.fill();
    plotPts.push({sx, sy, symbol: p.symbol, y: p.y});
  }
  lastPlot = {plotPts};
  // Save the current viewBox extents onto lastPlot so other handlers can access them
  lastPlot.viewBox = { xMin: xMin, xMax: xMax, yMin: yMin, yMax: yMax };
}

function redrawScatter() {
  // Reset viewBox on redraw so that new selections compute fresh extents
  viewBox = null;
  drawScatter(filterRows(activeRows()), document.getElementById('xSelect').value, document.getElementById('ySelect').value);
}

const canvas=document.getElementById('chart');
const tooltip=document.getElementById('tooltip');

canvas.addEventListener('mousemove',(ev)=>{
  if(!lastPlot) return;
  const r=canvas.getBoundingClientRect();
  const mx=ev.clientX-r.left, my=ev.clientY-r.top;
  let best=null, bestD=9999;
  for(const p of lastPlot.plotPts) {
    const dx=p.sx-mx, dy=p.sy-my;
    const d=Math.sqrt(dx*dx+dy*dy);
    if(d<bestD) { bestD=d; best=p; }
  }
  if(best && bestD<=8) {
    tooltip.style.display='block';
    const yKey = document.getElementById('ySelect').value;
    const isPct = (yKey==='retPct' || yKey==='deltaPct');
    const yText = (best.y==null || !isFinite(best.y)) ? '' : fmtNum(best.y, isPct);
    tooltip.textContent = (best.symbol||'') + (yText ? ('  ' + yText) : '');
    tooltip.style.left=best.sx+'px';
    tooltip.style.top=best.sy+'px';
  } else tooltip.style.display='none';
});
canvas.addEventListener('mouseleave',()=>tooltip.style.display='none');
// Zoom functionality: handle scroll wheel events on the canvas. When the user scrolls
// while hovering over the chart area, zoom in or out around the pointer. Scroll up
// (deltaY < 0) to zoom in; scroll down (deltaY > 0) to zoom out.
canvas.addEventListener('wheel',(ev)=>{
  // Only proceed if we have plotted points and a viewBox defined
  if(!lastPlot || !viewBox) return;
  // Prevent default page scroll
  ev.preventDefault();
  // Determine pointer position relative to the canvas
  const rect = canvas.getBoundingClientRect();
  const mx = ev.clientX - rect.left;
  const my = ev.clientY - rect.top;
  // Plot padding values must match those in drawScatter
  const padL=52, padR=18, padT=18, padB=42;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  const pw = w - padL - padR;
  const ph = h - padT - padB;
  // Only zoom if pointer lies within the plot area
  if(mx < padL || mx > padL + pw || my < padT || my > padT + ph) return;
  // Convert pointer to data coordinates using the current viewBox extents
  const xData = viewBox.xMin + ((mx - padL) / pw) * (viewBox.xMax - viewBox.xMin);
  const yData = viewBox.yMax - ((my - padT) / ph) * (viewBox.yMax - viewBox.yMin);
  // Choose zoom factor based on scroll direction
  const factor = ev.deltaY < 0 ? 0.9 : 1.1;
  // Compute new viewBox extents around the pointer
  const newXMin = xData - (xData - viewBox.xMin) * factor;
  const newXMax = xData + (viewBox.xMax - xData) * factor;
  const newYMin = yData - (yData - viewBox.yMin) * factor;
  const newYMax = yData + (viewBox.yMax - yData) * factor;
  // Update global viewBox
  viewBox = { xMin: newXMin, xMax: newXMax, yMin: newYMin, yMax: newYMax };
  // Redraw scatter without resetting zoom
  drawScatter(filterRows(activeRows()), document.getElementById('xSelect').value, document.getElementById('ySelect').value);
});

document.getElementById('xSelect').addEventListener('change',redrawScatter);
document.getElementById('ySelect').addEventListener('change',redrawScatter);
document.getElementById('symFilter').addEventListener('input',redrawScatter);
document.getElementById('resetBtn').addEventListener('click',()=>{ document.getElementById('xSelect').value='dteOpen'; document.getElementById('ySelect').value='pnl'; document.getElementById('symFilter').value=''; redrawScatter(); });

const btnC=document.getElementById('btnClosed'), btnO=document.getElementById('btnOpen');
const closedBlock=document.getElementById('closedBlock'), openBlock=document.getElementById('openBlock');
const pageTitle=document.getElementById('pageTitle'), scatterTitle=document.getElementById('scatterTitle');

function setActive(which) {
  activeMode=which;
  btnC.classList.remove('active'); btnO.classList.remove('active');
  closedBlock.style.display='none'; openBlock.style.display='none';
    if(which==='closed') {
    btnC.classList.add('active'); closedBlock.style.display='';
    // Append portfolio label to the page title
    pageTitle.textContent='Closed Trade Performance Statistics - $100 K Portfolio';
    scatterTitle.textContent='Interactive scatter (closed trades)';
  } else {
    btnO.classList.add('active'); openBlock.style.display='';
    pageTitle.textContent='Open Trade Performance Statistics - $100 K Portfolio';
    scatterTitle.textContent='Interactive scatter (open trades)';
  }
  redrawScatter();
}

btnC.addEventListener('click',()=>setActive('closed'));
btnO.addEventListener('click',()=>setActive('open'));

function wrapLines(ctx,text,maxW) {
  const words=(text||'').split(/\s+/).filter(Boolean);
  if(words.length<=1) return [text];
  const lines=[]; let line=words[0];
  for(let i=1;i<words.length;i++) {
    const test=line+' '+words[i];
    if(ctx.measureText(test).width<=maxW) line=test;
    else { lines.push(line); line=words[i]; if(lines.length>=2) break; }
  }
  lines.push(line);
  if(lines.length>2) { lines.length=2; lines[1]=lines[1].slice(0,Math.max(0,lines[1].length-1))+'…'; }
  return lines;
}

function drawBar(id,labels,values,yLabel,isPct=false) {
  const c=document.getElementById(id), ctx=c.getContext('2d');
  const w=c.clientWidth,h=c.clientHeight,dpr=window.devicePixelRatio||1;
  c.width=Math.floor(w*dpr); c.height=Math.floor(h*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,w,h);

  const padL=46,padR=14,padT=18,padB=88, pw=w-padL-padR, ph=h-padT-padB;
  const vals=values.map(v => (v==null ? 0 : Number(v)));
  let vMax=Math.max(...vals,1);
  if(isPct) vMax=Math.max(vMax,100);

  const tb = niceBounds(0, vMax, 5);
  const step = tb.step;
  const yS=v => padT + (1 - (v/vMax))*ph;

  ctx.strokeStyle='#1f2937'; ctx.beginPath(); ctx.moveTo(padL,padT); ctx.lineTo(padL,padT+ph); ctx.lineTo(padL+pw,padT+ph); ctx.stroke();
  ctx.fillStyle='#9ca3af'; ctx.font='12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';

  for(let t=0; t<=vMax+1e-9; t+=step) {
    const y=yS(t);
    ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+pw,y); ctx.stroke();
    ctx.fillText(fmtNum(t, isPct), 6, y+4);
  }

  const n=labels.length, gap=10, barW=(pw-gap*(n-1))/Math.max(n,1);
  for(let i=0;i<n;i++) {
    const v=vals[i]; const x=padL+i*(barW+gap); const y=yS(v); const hh=(padT+ph)-y;
    ctx.fillStyle='rgba(96,165,250,0.9)'; ctx.fillRect(x,y,barW,hh);
    const lines=wrapLines(ctx,labels[i],Math.max(barW+gap-2,40));
    ctx.fillStyle='#9ca3af'; ctx.textAlign='center';
    const base=padT+ph+22;
    for(let li=0; li<lines.length; li++) ctx.fillText(lines[li], x+barW/2, base+li*14);
  }
  ctx.fillStyle='#e5e7eb'; ctx.textAlign='left'; ctx.fillText(yLabel, padL+6, 12);
}

function redrawBars() {
  drawBar('barWin', tagLabels, tagWinRates, 'Win rate', true);
  drawBar('barPeak', tagLabels, tagTimeToPeak, 'Days to peak', false);
}

function colorizeClosedTable() {
  const table=document.getElementById('closedTable'); if(!table) return;
  const headers=[...table.querySelectorAll('thead th')].map(th=>th.textContent.trim());
  const idxPnL=headers.index_parsed = headers.indexOf('PnL');
  const idxRet=headers.indexOf('% Return');
  const idxDelta=headers.indexOf('Delta %');

  for(const row of table.querySelectorAll('tbody tr')) {
    const tds=row.querySelectorAll('td');
    const apply=(idx)=>{
      if(idx<0 || idx>=tds.length) return;
      const cell=tds[idx];
      const raw=(cell.textContent||'').replace(/,/g,'').trim();
      const v=parseFloat(raw);
      if(!Number.isFinite(v)) return;
      cell.classList.remove('pos','neg');
      if(v<0) cell.classList.add('neg');
      else if(v>0) cell.classList.add('pos');
    };
    apply(idxPnL); apply(idxRet); apply(idxDelta);
  }
}

window.addEventListener('resize',()=>{ redrawScatter(); redrawBars(); });
redrawBars();
setActive('closed');
colorizeClosedTable();
</script></body></html>
