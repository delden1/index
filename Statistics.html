<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Open Trade Performance Statistics</title>
<style>
:root{--bg:#0b0f14;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--border:#1f2937;--blue:#60a5fa;--red:#ef4444}
body{margin:0;padding:28px;background:var(--bg);color:var(--text);font:14px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:1250px;margin:0 auto}
h1{margin:0 0 6px;font-size:22px}
.lead{margin:0 0 14px;color:var(--muted);max-width:1050px}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin:12px 0}
.cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-top:8px}
@media(max-width:1050px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
.k{color:var(--muted);font-size:12px}
.v{font-size:22px;margin-top:6px}
.grid{display:grid;grid-template-columns:1.2fr 0.8fr;gap:12px}
@media(max-width:980px){.grid{grid-template-columns:1fr}body{padding:18px}}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 0}
select,input,button{background:#0f172a;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-size:13px}
button{cursor:pointer}
button.active{border-color:var(--blue);box-shadow:0 0 0 2px rgba(96,165,250,.25) inset}
canvas{width:100%;height:420px;display:block;background:#0b1220;border-radius:12px;border:1px solid var(--border)}
canvas.small{height:340px}
.table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.table th,.table td{padding:9px 10px;border-bottom:1px solid var(--border);white-space:nowrap}
.table th{text-align:left;font-weight:600;color:#d1d5db;background:#0f172a;position:sticky;top:0;z-index:1}
.tooltip{position:absolute;pointer-events:none;background:rgba(17,24,39,.95);border:1px solid var(--border);color:var(--text);padding:4px 6px;border-radius:10px;font-size:12px;display:none;white-space:nowrap;transform:translate(10px,-10px)}
.section-title{display:flex;align-items:center;justify-content:space-between;gap:12px}
.small{font-size:12px;color:var(--muted)}
.pos{color:var(--blue);font-weight:700}
.neg{color:var(--red);font-weight:700}
.defs{font-size:12px;line-height:1.45;color:var(--muted)}
.defs .term{color:var(--blue);font-weight:800}
.defs b{color:var(--blue);font-weight:800}
.defs .t1{color:var(--blue);font-weight:800}
.defs .t2{color:#a7f3d0;font-weight:800}
.defs .t3{color:#fbbf24;font-weight:800}
.defs .t4{color:#c4b5fd;font-weight:800}
</style></head><body><div class="wrap">
<div class="section-title">
  <div>
    <h1 id="pageTitle">Open Trade Performance Statistics</h1>
    <p class="lead">This report was generated from an open-trades-only export. The toggle still works, but Closed will be empty.</p>
  </div>
  <div class="controls" style="margin:0;">
    <button id="btnClosed">Closed</button>
    <button id="btnOpen" class="active">Open</button>
  </div>
</div>

<div id="closedBlock" style="display:none;"><div class="cards">
  <div class="card"><div class="k">Closed trades</div><div class="v">0.0</div></div>
  <div class="card"><div class="k">Win rate</div><div class="v">—</div></div>
  <div class="card"><div class="k">Profit factor</div><div class="v">—</div></div>
  <div class="card"><div class="k">Median % return</div><div class="v">—</div></div>
</div></div>

<div id="openBlock"><div class="cards">
  <div class="card"><div class="k">Open trades</div><div class="v">6.0</div></div>
  <div class="card"><div class="k">Win rate (current PnL)</div><div class="v">100.0%</div></div>
  <div class="card"><div class="k">Profit factor (current PnL)</div><div class="v">∞</div></div>
  <div class="card"><div class="k">Median unrealized % return</div><div class="v">150.8%</div></div>
</div></div>

<div class="card"><div class="grid">
  <div style="position:relative">
    <div class="k" id="scatterTitle">Interactive scatter (open trades)</div>
    <div class="controls">
      <label class="small">X-axis:</label>
      <select id="xSelect">
        <option value="dteOpen">DTE at Open</option>
        <option value="holdDays">Hold / Age (days)</option>
        <option value="vol">Total Volume</option>
        <option value="openPrice">Open Price</option>
        <option value="closePrice">Close Price</option>
        <option value="deltaPct">Delta %</option>
      </select>
      <label class="small">Y-axis:</label>
      <select id="ySelect">
        <option value="pnl">PnL ($)</option>
        <option value="retPct">% Return</option>
        <option value="tradeMFE">Trade MFE ($)</option>
        <option value="tradeMAE">Trade MAE ($)</option>
        <option value="tradeRatio">Trade MFE/MAE</option>
        <option value="openPrice">Open Price</option>
        <option value="closePrice">Close Price</option>
        <option value="deltaPct">Delta %</option>
      </select>
      <label class="small">Filter symbol contains:</label>
      <input id="symFilter" placeholder="e.g., NVDA"/>
      <button id="resetBtn">Reset</button>
    </div>
    <canvas id="chart"></canvas>
    <div class="tooltip" id="tooltip"></div>
  </div>

  <div>
    <div class="k">Definitions</div>
    <div class="defs" style="margin-top:8px">
      <div><span class="term t1">Delta %</span> — percent change between Open Price and Close Price.</div>
      <div style="margin-top:6px"><span class="term t2">PnL</span> — profit or loss. Closed view uses realized PnL; Open view uses current PnL.</div>
      <div style="margin-top:6px"><span class="term t2">% Return</span> — trade return. Closed view uses realized return; Open view uses unrealized return.</div>
      <div style="margin-top:6px"><span class="term t3">Trade MFE</span> — highest unrealized profit the trade reached while it was open.</div>
      <div style="margin-top:6px"><span class="term t3">Trade MAE</span> — lowest unrealized profit (largest drawdown) the trade reached while it was open.</div>
      <div style="margin-top:6px"><span class="term t4">Trade MFE/MAE</span> — Trade MFE divided by the absolute value of Trade MAE.</div>

      <div style="margin-top:10px"><span class="term">Median % return</span> — middle value of % Return across trades.</div>
      <div style="margin-top:6px"><span class="term">Median duration</span> — middle value of duration (days held) across trades.</div>
      <div style="margin-top:6px"><span class="term">Median capture</span> — middle value of (PnL ÷ Trade MFE) on winning trades.</div>
      <div style="margin-top:6px"><span class="term">Median time to peak</span> — middle number of days from entry until a winning trade hit its max profit (MFE).</div>
      <div style="margin-top:6px"><span class="term">Median days after peak</span> — middle number of days a winning trade was held after it hit its max profit (MFE).</div>
    </div>
  </div>
</div></div>

<div class="card"><div class="grid">
  <div><div class="k">Win rate by structure (open trades)</div><canvas id="barWin" class="small"></canvas></div>
  <div><div class="k">Typical time-to-peak (median MFE timing, open trades)</div><canvas id="barPeak" class="small"></canvas></div>
</div></div>

<div class="card"><div class="k">Closed trades table</div><div id="closedTableWrap"><table border="1" class="dataframe table" id="closedTable">
  <thead>
    <tr style="text-align: right;">
      <th>Close Date</th>
      <th>Symbol</th>
      <th>Tags</th>
      <th>Strikes</th>
      <th>Open Price</th>
      <th>Close Price</th>
      <th>Delta %</th>
      <th>DTE (Open)</th>
      <th>Hold (days)</th>
      <th>Total Volume</th>
      <th>PnL</th>
      <th>% Return</th>
      <th>Trade MAE</th>
      <th>Trade MFE</th>
      <th>Trade MFE/MAE</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table></div></div>
<div class="small">Generated by Strategic Options trader</div></div>

<script>
const CLOSED_ROWS=[];
const OPEN_ROWS=[{"symbol": "NEM", "tags": "Synthetic", "dteOpen": 177.0, "holdDays": 32.58006865053241, "vol": 4.0, "pnl": 3684.0, "retPct": 289.62264150943395, "tradeMFE": 912.0, "tradeMAE": -22962.0, "tradeRatio": 0.03971779461719362, "openPrice": 6.36, "closePrice": null, "deltaPct": 289.62264150943395}, {"symbol": "VZLA", "tags": "Vertical Bull Call", "dteOpen": 122.0, "holdDays": 39.46836726164352, "vol": 50.0, "pnl": 1475.0, "retPct": null, "tradeMFE": 13425.0, "tradeMAE": -125.0, "tradeRatio": 107.4, "openPrice": 0.0, "closePrice": null, "deltaPct": null}, {"symbol": "CDE", "tags": "Vertical Bull Call", "dteOpen": 154.0, "holdDays": 43.49612189127315, "vol": 42.0, "pnl": 1764.0, "retPct": null, "tradeMFE": 46672.5, "tradeMAE": -1281.0, "tradeRatio": 36.4344262295082, "openPrice": 0.0, "closePrice": null, "deltaPct": null}, {"symbol": "SILJ", "tags": "Vertical Bull Call", "dteOpen": 38.0, "holdDays": 12.358540872754629, "vol": 20.0, "pnl": 1820.0, "retPct": null, "tradeMFE": 35210.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 0.0, "closePrice": null, "deltaPct": null}, {"symbol": "SA", "tags": "Vertical Bull Call", "dteOpen": 151.0, "holdDays": 40.47931633571759, "vol": 18.0, "pnl": 594.0, "retPct": null, "tradeMFE": 27504.0, "tradeMAE": -648.0, "tradeRatio": 42.44444444444444, "openPrice": 0.0, "closePrice": null, "deltaPct": null}, {"symbol": "SLV", "tags": "Vertical Bull Call", "dteOpen": 155.0, "holdDays": 44.543749206087966, "vol": 22.0, "pnl": 2310.0, "retPct": 11.931818181818182, "tradeMFE": 95249.0, "tradeMAE": 0.0, "tradeRatio": null, "openPrice": 0.0, "closePrice": null, "deltaPct": 11.931818181818182}];
const tagLabels=["Synthetic", "Vertical Bull Call"];
const tagWinRates=[100.0, 100.0];
const tagTimeToPeak=[29.1, 38.0];
let activeMode='open';

function activeRows(){ return (activeMode==='open') ? OPEN_ROWS : CLOSED_ROWS; }
function getVal(r,k){ const v=r[k]; return (v===null||v===undefined||Number.isNaN(v)) ? null : Number(v); }
function filterRows(rows){ const f=document.getElementById('symFilter').value.trim().toUpperCase(); if(!f) return rows; return rows.filter(r => (r.symbol||'').toUpperCase().includes(f)); }

function niceNumber(x, roundIt){
  if(!isFinite(x) || x<=0) return 1;
  const exp = Math.floor(Math.log10(x));
  const f = x / Math.pow(10, exp);
  let nf;
  if(roundIt){
    if(f < 1.5) nf = 1;
    else if(f < 3) nf = 2;
    else if(f < 7) nf = 5;
    else nf = 10;
  } else {
    if(f <= 1) nf = 1;
    else if(f <= 2) nf = 2;
    else if(f <= 5) nf = 5;
    else nf = 10;
  }
  return nf * Math.pow(10, exp);
}
function niceBounds(minV, maxV, ticksWanted){
  const range = niceNumber(maxV - minV, false);
  const step = niceNumber(range / Math.max(1, ticksWanted-1), true);
  const niceMin = Math.floor(minV / step) * step;
  const niceMax = Math.ceil(maxV / step) * step;
  return {niceMin, niceMax, step};
}

let lastPlot=null;
function drawScatter(data,xKey,yKey) {
  const c=document.getElementById('chart'); const ctx=c.getContext('2d'); const tt=document.getElementById('tooltip');
  const w=c.clientWidth,h=c.clientHeight,dpr=window.devicePixelRatio||1;
  c.width=Math.floor(w*dpr); c.height=Math.floor(h*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,w,h);

  const isPct=(yKey==='retPct'||yKey==='deltaPct');
  const pts=[];
  for(const r of data) {
    const x=getVal(r,xKey); const y=getVal(r,yKey);
    if(x===null||y===null) continue;
    pts.push({x,y,symbol:r.symbol});
  }
  tt.style.display='none';
  if(!pts.length) { ctx.fillStyle='#9ca3af'; ctx.fillText('No data matches the current filter.',16,24); lastPlot=null; return; }

  const padL=52,padR=18,padT=18,padB=42; const pw=w-padL-padR, ph=h-padT-padB;

  let xMin=Math.min(...pts.map(p=>p.x)), xMax=Math.max(...pts.map(p=>p.x));
  let yMin=Math.min(...pts.map(p=>p.y)), yMax=Math.max(...pts.map(p=>p.y));

  const xPad=(xMax-xMin)*0.05||1, yPad=(yMax-yMin)*0.08||1;
  xMin-=xPad; xMax+=xPad; yMin-=yPad; yMax+=yPad;

  const xS=x=>padL+(x-xMin)/(xMax-xMin)*pw;
  const yS=y=>padT+(1-(y-yMin)/(yMax-yMin))*ph;

  ctx.strokeStyle='#1f2937'; ctx.lineWidth=1;
  ctx.beginPath(); ctx.moveTo(padL,padT); ctx.lineTo(padL,padT+ph); ctx.lineTo(padL+pw,padT+ph); ctx.stroke();

  ctx.fillStyle='#9ca3af';
  ctx.font='12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';

  for(let i=0;i<=5;i++) {
    const t=xMin+(xMax-xMin)*(i/5); const x=xS(t);
    ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(x,padT); ctx.lineTo(x,padT+ph); ctx.stroke();
    ctx.fillText(t.toFixed(1), x-12, padT+ph+18);
  }

  const tb = niceBounds(yMin, yMax, 5);
  const y0 = tb.niceMin, y1 = tb.niceMax, step = tb.step;

  for(let t=y0; t<=y1+1e-9; t+=step) {
    const y=yS(t);
    ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+pw,y); ctx.stroke();
    const lab=isPct ? (t.toFixed(1)+'%') : (t.toFixed(1));
    ctx.fillText(lab, 8, y+4);
  }

  ctx.fillStyle='#e5e7eb';
  const xLab=document.getElementById('xSelect').selectedOptions[0].textContent;
  const yLab=document.getElementById('ySelect').selectedOptions[0].textContent;
  ctx.fillText(xLab, padL+pw/2-40, padT+ph+36);
  ctx.save(); ctx.translate(14, padT+ph/2+30); ctx.rotate(-Math.PI/2); ctx.fillText(yLab,0,0); ctx.restore();

  const plotPts=[];
  for(const p of pts) {
    const sx=xS(p.x), sy=yS(p.y);
    ctx.fillStyle=(p.y<0) ? 'rgba(239,68,68,0.9)' : 'rgba(96,165,250,0.9)';
    ctx.beginPath(); ctx.arc(sx,sy,3.2,0,Math.PI*2); ctx.fill();
    plotPts.push({sx,sy,symbol:p.symbol,y:p.y});
  }
  lastPlot={plotPts};
}

function redrawScatter() {
  drawScatter(filterRows(activeRows()), document.getElementById('xSelect').value, document.getElementById('ySelect').value);
}

const canvas=document.getElementById('chart');
const tooltip=document.getElementById('tooltip');

canvas.addEventListener('mousemove',(ev)=>{
  if(!lastPlot) return;
  const r=canvas.getBoundingClientRect();
  const mx=ev.clientX-r.left, my=ev.clientY-r.top;
  let best=null, bestD=9999;
  for(const p of lastPlot.plotPts) {
    const dx=p.sx-mx, dy=p.sy-my;
    const d=Math.sqrt(dx*dx+dy*dy);
    if(d<bestD) { bestD=d; best=p; }
  }
  if(best && bestD<=8) {
    tooltip.style.display='block';
    const yKey = document.getElementById('ySelect').value;
    const isPct = (yKey==='retPct' || yKey==='deltaPct');
    const yText = (best.y==null || !isFinite(best.y)) ? '' : (isPct ? (best.y.toFixed(1)+'%') : best.y.toFixed(1));
    tooltip.textContent = (best.symbol||'') + (yText ? ('  ' + yText) : '');
    tooltip.style.left=best.sx+'px';
    tooltip.style.top=best.sy+'px';
  } else tooltip.style.display='none';
});
canvas.addEventListener('mouseleave',()=>tooltip.style.display='none');

document.getElementById('xSelect').addEventListener('change',redrawScatter);
document.getElementById('ySelect').addEventListener('change',redrawScatter);
document.getElementById('symFilter').addEventListener('input',redrawScatter);
document.getElementById('resetBtn').addEventListener('click',()=>{ document.getElementById('xSelect').value='dteOpen'; document.getElementById('ySelect').value='pnl'; document.getElementById('symFilter').value=''; redrawScatter(); });

const btnC=document.getElementById('btnClosed'), btnO=document.getElementById('btnOpen');
const closedBlock=document.getElementById('closedBlock'), openBlock=document.getElementById('openBlock');
const pageTitle=document.getElementById('pageTitle'), scatterTitle=document.getElementById('scatterTitle');

function setActive(which) {
  activeMode=which;
  btnC.classList.remove('active'); btnO.classList.remove('active');
  closedBlock.style.display='none'; openBlock.style.display='none';
  if(which==='closed') {
    btnC.classList.add('active'); closedBlock.style.display='';
    pageTitle.textContent='Closed Trade Performance Statistics'; scatterTitle.textContent='Interactive scatter (closed trades)';
  } else {
    btnO.classList.add('active'); openBlock.style.display='';
    pageTitle.textContent='Open Trade Performance Statistics'; scatterTitle.textContent='Interactive scatter (open trades)';
  }
  redrawScatter();
}

btnC.addEventListener('click',()=>setActive('closed'));
btnO.addEventListener('click',()=>setActive('open'));

function wrapLines(ctx,text,maxW) {
  const words=(text||'').split(/\s+/).filter(Boolean);
  if(words.length<=1) return [text];
  const lines=[]; let line=words[0];
  for(let i=1;i<words.length;i++) {
    const test=line+' '+words[i];
    if(ctx.measureText(test).width<=maxW) line=test;
    else { lines.push(line); line=words[i]; if(lines.length>=2) break; }
  }
  lines.push(line);
  if(lines.length>2) { lines.length=2; lines[1]=lines[1].slice(0,Math.max(0,lines[1].length-1))+'…'; }
  return lines;
}

function drawBar(id,labels,values,yLabel,isPct=false) {
  const c=document.getElementById(id), ctx=c.getContext('2d');
  const w=c.clientWidth,h=c.clientHeight,dpr=window.devicePixelRatio||1;
  c.width=Math.floor(w*dpr); c.height=Math.floor(h*dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,w,h);

  const padL=46,padR=14,padT=18,padB=88, pw=w-padL-padR, ph=h-padT-padB;
  const vals=values.map(v => (v==null ? 0 : Number(v)));
  let vMax=Math.max(...vals,1);
  if(isPct) vMax=Math.max(vMax,100);

  const tb = niceBounds(0, vMax, 5);
  const step = tb.step;
  const yS=v => padT + (1 - (v/vMax))*ph;

  ctx.strokeStyle='#1f2937'; ctx.beginPath(); ctx.moveTo(padL,padT); ctx.lineTo(padL,padT+ph); ctx.lineTo(padL+pw,padT+ph); ctx.stroke();
  ctx.fillStyle='#9ca3af'; ctx.font='12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';

  for(let t=0; t<=vMax+1e-9; t+=step) {
    const y=yS(t);
    ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+pw,y); ctx.stroke();
    ctx.fillText(isPct ? (t.toFixed(1)+'%') : t.toFixed(1), 6, y+4);
  }

  const n=labels.length, gap=10, barW=(pw-gap*(n-1))/Math.max(n,1);
  for(let i=0;i<n;i++) {
    const v=vals[i]; const x=padL+i*(barW+gap); const y=yS(v); const hh=(padT+ph)-y;
    ctx.fillStyle='rgba(96,165,250,0.9)'; ctx.fillRect(x,y,barW,hh);
    const lines=wrapLines(ctx,labels[i],Math.max(barW+gap-2,40));
    ctx.fillStyle='#9ca3af'; ctx.textAlign='center';
    const base=padT+ph+22;
    for(let li=0; li<lines.length; li++) ctx.fillText(lines[li], x+barW/2, base+li*14);
  }
  ctx.fillStyle='#e5e7eb'; ctx.textAlign='left'; ctx.fillText(yLabel, padL+6, 12);
}

function redrawBars() {
  drawBar('barWin', tagLabels, tagWinRates, 'Win rate', true);
  drawBar('barPeak', tagLabels, tagTimeToPeak, 'Days to peak', false);
}

function colorizeClosedTable() {
  const table=document.getElementById('closedTable'); if(!table) return;
  const headers=[...table.querySelectorAll('thead th')].map(th=>th.textContent.trim());
  const idxPnL=headers.indexOf('PnL');
  const idxRet=headers.indexOf('% Return');
  const idxDelta=headers.indexOf('Delta %');
  for(const row of table.querySelectorAll('tbody tr')) {
    const tds=row.querySelectorAll('td');
    const apply=(idx)=>{
      if(idx<0 || idx>=tds.length) return;
      const cell=tds[idx];
      const raw=(cell.textContent||'').replace(/,/g,'').trim();
      const v=parseFloat(raw);
      if(!Number.isFinite(v)) return;
      cell.classList.remove('pos','neg');
      if(v<0) cell.classList.add('neg');
      else if(v>0) cell.classList.add('pos');
    };
    apply(idxPnL); apply(idxRet); apply(idxDelta);
  }
}

window.addEventListener('resize',()=>{ redrawScatter(); redrawBars(); });
redrawBars();
setActive('open');
colorizeClosedTable();
</script></body></html>
